<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Kinh Do Foods | Home</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500;600;700&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
</head>
<body class="age-gate-open">
  <div class="age-gate-backdrop" id="age-gate" role="dialog" aria-modal="true" aria-labelledby="age-gate-title">
    <div class="age-gate-modal">
      <button type="button" class="age-gate-close" id="age-gate-close" aria-label="Đóng cửa sổ xác minh tuổi">
        <span aria-hidden="true">&times;</span>
      </button>
      <h2 id="age-gate-title" data-i18n="ageGateTitle">Xác nhận độ tuổi</h2>
      <p class="age-gate-description" data-i18n="ageGateDescription">Chọn năm sinh của bạn để tiếp tục vào Kinh Đô Foods.</p>
      <div class="age-picker" role="group">
        <div
          class="age-picker-wheel"
          id="age-picker"
          role="listbox"
          aria-label="Chọn năm sinh của bạn"
          tabindex="0"
        >
          <ul class="age-picker-options" id="age-picker-list"></ul>
        </div>
        <div class="age-picker-highlight" aria-hidden="true"></div>
      </div>
      <p class="age-gate-disclaimer">
        <em>*This data will not be stored anywhere.</em><br />
        <em>*Dữ liệu này sẽ không được lưu trữ ở bất kỳ đâu.</em>
      </p>
      <p class="age-gate-footnote" id="age-gate-footnote" aria-live="polite"></p>
      <button class="btn btn-primary age-gate-confirm" type="button" id="age-gate-confirm" data-i18n="ageGateConfirm">
        Vào trang web
      </button>
    </div>
  </div>
  <header class="site-header">
    <div class="container nav-bar">
      <a class="brand" href="index.html">
        <img src="logo-kinh-do-635x516-152344819.png" alt="Kinh Do Foods logo" />
      </a>
      <nav aria-label="Primary">
        <ul>
          <li><a class="active" aria-current="page" data-i18n="navHome" href="index.html">Home</a></li>
          <li><a data-i18n="navProducts" href="products.html">Products</a></li>
          <li><a data-i18n="navContact" href="contact.html">Contact</a></li>
        </ul>
      </nav>
      <div class="header-actions">
        <button class="btn btn-ghost language-toggle" type="button" id="language-toggle" aria-label="Switch to Vietnamese">
          Tiếng Việt
        </button>
        <a class="btn btn-primary" data-i18n="navShop" href="products.html">Shop Mid-Autumn</a>
      </div>
    </div>
  </header>

  <main>
    <section class="hero" id="hero">
      <div class="container">
        <div class="hero-note hero-content">
          <span class="hero-eyebrow" data-i18n="heroEyebrow">Since 1993</span>
          <h1 data-i18n="heroTitle">Crafting Joyful Mooncake Moments</h1>
          <p data-i18n="heroDescription">
            From our bakery in Ho Chi Minh City to celebrations around the world, Kinh Do Foods
            brings together tradition, artistry, and contemporary flavours for Mid-Autumn gatherings.
          </p>
          <div class="cta-group">
            <a class="btn btn-primary" data-i18n="heroPrimaryCta" href="products.html">Explore Collections</a>
            <a class="btn btn-ghost" data-i18n="heroSecondaryCta" href="contact.html">Connect with Us</a>
          </div>
        </div>
        <div class="card hero-card" aria-hidden="true">
          <figure class="hero-card-media">
            <img
              src="vn-11134207-7r98o-lr866fv2vj5w60-3532510397.jpg"
              alt="Lotus seed and salted egg yolk mooncake with decorative packaging."
              loading="lazy"
            />
          </figure>
          <span class="card-overline" data-i18n="heroCardOverline">Moonlit Signature</span>
          <h2
            data-i18n="heroCardTitle"
            data-i18n-classic="heroCardTitle"
            data-i18n-genz="heroCardTitleGenZ"
          >
            Lotus Seed &amp; Golden Yolk
          </h2>
          <p
            data-i18n="heroCardDescription"
            data-i18n-classic="heroCardDescription"
            data-i18n-genz="heroCardDescriptionGenZ"
          >
            A harmonious blend of velvety lotus paste and salted egg yolk crafted for family traditions.
          </p>
          <div class="hero-card-footer">
            <span data-i18n="heroCardFootnote1">Limited seasonal batch</span>
            <span data-i18n="heroCardFootnote2">Available now</span>
          </div>
        </div>
      </div>
    </section>

    <section class="photo-gallery" aria-labelledby="gallery-title">
      <div class="container">
        <div class="section-heading">
          <h2 id="gallery-title" data-i18n="galleryHeading">Moments from Our Bakery</h2>
          <p data-i18n="galleryDescription">Glowing lanterns, freshly baked mooncakes, and festive gift sets that celebrate every Mid-Autumn gathering.</p>
        </div>
        <div class="gallery-grid">
          <figure class="gallery-card">
            <img src="home%20images/banh-kinh-do-1142696503.jpg" alt="Decorative tins of Kinh Do mooncakes arranged beside tea." />
            <figcaption data-i18n="galleryCaption1">Seasonal mooncake tins ready to delight families and friends.</figcaption>
          </figure>
          <figure class="gallery-card">
            <img src="home%20images/Mua-banh-trung-thu-Kinh-Do-o-dau-Bang-gia-3704805917.jpg" alt="Display of assorted Kinh Do mooncakes in bright red packaging." />
            <figcaption data-i18n="galleryCaption2">Bold red packaging that captures the spirit of Mid-Autumn festivals.</figcaption>
          </figure>
          <figure class="gallery-card">
            <img src="home%20images/2384-1-1606988458230392212630-3099024397.jpg" alt="A close-up of mooncakes with golden crusts and patterned tops." />
            <figcaption data-i18n="galleryCaption3">Handcrafted crusts stamped with heritage motifs and golden shine.</figcaption>
          </figure>
          <figure class="gallery-card">
            <img src="home%20images/banh-kinh-do-1373247095.png" alt="Gift box with mooncakes, teacups, and lantern decorations." />
            <figcaption data-i18n="galleryCaption4">Curated gift boxes pairing mooncakes with tea for heartfelt gifting.</figcaption>
          </figure>
        </div>
      </div>
    </section>

    <section id="story">
      <div class="container our-story">
        <div class="section-heading">
          <h2 data-i18n="storyHeading">Our Story</h2>
          <p data-i18n="storyIntro">
            What began as a family bakery has flourished into a beloved Vietnamese brand honouring community, culture,
            and the delight of sharing mooncakes beneath the full moon.
          </p>
        </div>
        <div class="story-grid">
          <article class="card story-card">
            <h3 data-i18n="storyCard1Title">Handcrafted Beginnings</h3>
            <p data-i18n="storyCard1Description">
              Brothers Tran and Nguyen opened the first Kinh Do bakery, experimenting with family recipes and inviting
              neighbours to taste the very first lotus seed mooncakes.
            </p>
          </article>
          <article class="card story-card">
            <h3 data-i18n="storyCard2Title">Growing With Vietnam</h3>
            <p data-i18n="storyCard2Description">
              Throughout the 2000s we expanded across the country, introducing breads, biscuits, and festive hampers
              that brightened celebrations in every province.
            </p>
          </article>
          <article class="card story-card">
            <h3 data-i18n="storyCard3Title">Sharing the Glow Worldwide</h3>
            <p data-i18n="storyCard3Description">
              Today our artisanal mooncakes travel globally, connecting Vietnamese communities with meaningful flavours
              and design-led gifting experiences.
            </p>
          </article>
        </div>
      </div>
    </section>

    <section id="sustainability">
      <div class="container sustainability">
        <div class="section-heading">
          <h2 data-i18n="sustainabilityHeading">Savour the Future Responsibly</h2>
          <p data-i18n="sustainabilityIntro">Every celebration can be mindful. We champion thoughtful sourcing and packaging for the next generation.</p>
        </div>
        <div class="sustainability-grid">
          <article class="sustainability-card">
            <h4 data-i18n="sustainabilityCard1Title">Local Ingredients</h4>
            <p data-i18n="sustainabilityCard1Description">We partner with Vietnamese farmers to source lotus seeds, tropical fruits, and fragrant teas harvested with care.</p>
          </article>
          <article class="sustainability-card">
            <h4 data-i18n="sustainabilityCard2Title">Eco Packaging</h4>
            <p data-i18n="sustainabilityCard2Description">Our boxes are crafted from recycled fibres, soy-based inks, and modular inserts that reduce single-use materials.</p>
          </article>
          <article class="sustainability-card">
            <h4 data-i18n="sustainabilityCard3Title">Community Programs</h4>
            <p data-i18n="sustainabilityCard3Description">Festive giving drives support education and nutrition initiatives, spreading joy beyond the holiday table.</p>
          </article>
          <article class="sustainability-card">
            <h4 data-i18n="sustainabilityCard4Title">Zero Waste Bakeries</h4>
            <p data-i18n="sustainabilityCard4Description">We optimise production with precise batching, redistributing surplus to local partners and charities.</p>
          </article>
        </div>
      </div>
    </section>

    <section>
      <div class="container cta-banner">
        <h3 data-i18n="ctaBannerHeading">Design Your Next Celebration with Kinh Do</h3>
        <p data-i18n="ctaBannerText">Collaborate with our culinary artists to compose bespoke mooncake experiences and seasonal hampers.</p>
        <a class="btn btn-ghost" data-i18n="ctaBannerButton" href="contact.html">Start a Conversation</a>
      </div>
    </section>
  </main>

  <footer>
    <div class="container">
      <small>&copy; <span id="year"></span> <span data-i18n="footerCopy">Kinh Do Foods. All rights reserved.</span></small>
      <small><span data-i18n="footerSocial">Follow our journey on</span> <a href="#">Instagram</a> · <a href="#">Facebook</a> · <a href="#">YouTube</a></small>
    </div>
  </footer>

  <script>
    document.getElementById('year').textContent = new Date().getFullYear();

    const translations = {
      en: {
        navHome: 'Home',
        navProducts: 'Products',
        navContact: 'Contact',
        navShop: 'Shop Mid-Autumn',
        heroEyebrow: 'Since 1993',
        heroTitle: 'Crafting Joyful Mooncake Moments',
        heroDescription:
          'From our bakery in Ho Chi Minh City to celebrations around the world, Kinh Do Foods brings together tradition, artistry, and contemporary flavours for Mid-Autumn gatherings.',
        heroPrimaryCta: 'Explore Collections',
        heroSecondaryCta: 'Connect with Us',
        heroCardOverline: 'Moonlit Signature',
        heroCardTitle: 'Lotus Seed & Golden Yolk',
        heroCardDescription:
          'A harmonious blend of velvety lotus paste and salted egg yolk crafted for family traditions.',
        heroCardTitleGenZ: 'Lava Mooncake with Aged Melting Eggs',
        heroCardDescriptionGenZ:
          'Custard lava mooncakes with slow-aged salted egg centres crafted for bold-night celebrations.',
        heroCardFootnote1: 'Limited seasonal batch',
        heroCardFootnote2: 'Available now',
        galleryHeading: 'Moments from Our Bakery',
        galleryDescription:
          'Glowing lanterns, freshly baked mooncakes, and festive gift sets that celebrate every Mid-Autumn gathering.',
        galleryCaption1: 'Seasonal mooncake tins ready to delight families and friends.',
        galleryCaption2: 'Bold red packaging that captures the spirit of Mid-Autumn festivals.',
        galleryCaption3: 'Handcrafted crusts stamped with heritage motifs and golden shine.',
        galleryCaption4: 'Curated gift boxes pairing mooncakes with tea for heartfelt gifting.',
        storyHeading: 'Our Story',
        storyIntro:
          'What began as a family bakery has flourished into a beloved Vietnamese brand honouring community, culture, and the delight of sharing mooncakes beneath the full moon.',
        storyCard1Title: 'Handcrafted Beginnings',
        storyCard1Description:
          'Brothers Tran and Nguyen opened the first Kinh Do bakery, experimenting with family recipes and inviting neighbours to taste the very first lotus seed mooncakes.',
        storyCard2Title: 'Growing With Vietnam',
        storyCard2Description:
          'Throughout the 2000s we expanded across the country, introducing breads, biscuits, and festive hampers that brightened celebrations in every province.',
        storyCard3Title: 'Sharing the Glow Worldwide',
        storyCard3Description:
          'Today our artisanal mooncakes travel globally, connecting Vietnamese communities with meaningful flavours and design-led gifting experiences.',
        sustainabilityHeading: 'Savour the Future Responsibly',
        sustainabilityIntro:
          'Every celebration can be mindful. We champion thoughtful sourcing and packaging for the next generation.',
        sustainabilityCard1Title: 'Local Ingredients',
        sustainabilityCard1Description:
          'We partner with Vietnamese farmers to source lotus seeds, tropical fruits, and fragrant teas harvested with care.',
        sustainabilityCard2Title: 'Eco Packaging',
        sustainabilityCard2Description:
          'Our boxes are crafted from recycled fibres, soy-based inks, and modular inserts that reduce single-use materials.',
        sustainabilityCard3Title: 'Community Programs',
        sustainabilityCard3Description:
          'Festive giving drives support education and nutrition initiatives, spreading joy beyond the holiday table.',
        sustainabilityCard4Title: 'Zero Waste Bakeries',
        sustainabilityCard4Description:
          'We optimise production with precise batching, redistributing surplus to local partners and charities.',
        ctaBannerHeading: 'Design Your Next Celebration with Kinh Do',
        ctaBannerText:
          'Collaborate with our culinary artists to compose bespoke mooncake experiences and seasonal hampers.',
        ctaBannerButton: 'Start a Conversation',
        footerCopy: 'Kinh Do Foods. All rights reserved.',
        footerSocial: 'Follow our journey on',
        ageGateTitle: 'Confirm Your Age',
        ageGateDescription: 'Select your birth year to continue to Kinh Do Foods.',
        ageGateConfirm: 'Enter Website'
      },
      vi: {
        navHome: 'Trang chủ',
        navProducts: 'Sản phẩm',
        navContact: 'Liên hệ',
        navShop: 'Mua sắm mùa Trung Thu',
        heroEyebrow: 'Từ năm 1993',
        heroTitle: 'Kiến tạo khoảnh khắc bánh trung thu hạnh phúc',
        heroDescription:
          'Từ tiệm bánh của chúng tôi tại TP. Hồ Chí Minh đến những buổi sum họp khắp thế giới, Kinh Đô kết nối truyền thống, nghệ thuật và hương vị đương đại cho mùa Trung Thu.',
        heroPrimaryCta: 'Khám phá bộ sưu tập',
        heroSecondaryCta: 'Kết nối với chúng tôi',
        heroCardOverline: 'Dấu ấn đêm trăng',
        heroCardTitle: 'Hạt sen & trứng muối vàng',
        heroCardDescription:
          'Sự hòa quyện của nhân sen mịn màng và trứng muối đậm đà dành cho những buổi đoàn viên gia đình.',
        heroCardTitleGenZ: 'Hộp Lava trứng chảy',
        heroCardDescriptionGenZ:
          'Phiên bản lava sánh mịn cùng trứng muối ủ lâu cho trải nghiệm tan chảy đậm đà.',
        heroCardFootnote1: 'Sản xuất theo mùa giới hạn',
        heroCardFootnote2: 'Đang mở bán',
        galleryHeading: 'Khoảnh khắc từ tiệm bánh của chúng tôi',
        galleryDescription:
          'Đèn lồng rực rỡ, bánh trung thu mới ra lò và những hộp quà lễ hội tôn vinh mọi mùa đoàn viên.',
        galleryCaption1: 'Hộp bánh trung thu theo mùa sẵn sàng trao tặng người thân, bạn bè.',
        galleryCaption2: 'Bao bì đỏ rực thể hiện trọn vẹn tinh thần lễ hội Trung Thu.',
        galleryCaption3: 'Vỏ bánh thủ công in hoa văn truyền thống óng ánh vàng.',
        galleryCaption4: 'Hộp quà tinh tế kết hợp bánh trung thu và trà cho món quà đầy yêu thương.',
        storyHeading: 'Câu chuyện của chúng tôi',
        storyIntro:
          'Khởi đầu là tiệm bánh gia đình, chúng tôi đã trở thành thương hiệu Việt Nam được yêu mến, tôn vinh cộng đồng, văn hóa và niềm vui sum vầy dưới trăng rằm.',
        storyCard1Title: 'Khởi đầu thủ công',
        storyCard1Description:
          'Hai anh em Trần và Nguyễn mở tiệm Kinh Đô đầu tiên, thử nghiệm công thức gia truyền và mời hàng xóm thưởng thức những chiếc bánh sen đầu tiên.',
        storyCard2Title: 'Lớn lên cùng Việt Nam',
        storyCard2Description:
          'Trong suốt những năm 2000 chúng tôi phủ sóng khắp cả nước với bánh mì, bánh quy và giỏ quà lễ hội làm sáng rực mọi mùa sum họp.',
        storyCard3Title: 'Lan tỏa hương vị ra thế giới',
        storyCard3Description:
          'Ngày nay bánh trung thu thủ công của chúng tôi đến với cộng đồng Việt toàn cầu, kết nối bằng hương vị ý nghĩa và trải nghiệm quà tặng tinh tế.',
        sustainabilityHeading: 'Hưởng trọn tương lai bền vững',
        sustainabilityIntro:
          'Mỗi buổi lễ đều có thể trọn vẹn và ý thức. Chúng tôi đề cao nguồn nguyên liệu và bao bì thân thiện cho thế hệ mai sau.',
        sustainabilityCard1Title: 'Nguyên liệu bản địa',
        sustainabilityCard1Description:
          'Chúng tôi hợp tác cùng nông hộ Việt Nam để thu mua hạt sen, trái cây nhiệt đới và trà thơm được chăm sóc kỹ lưỡng.',
        sustainabilityCard2Title: 'Bao bì xanh',
        sustainabilityCard2Description:
          'Hộp bánh làm từ sợi tái chế, mực in đậu nành và khay mô-đun giúp giảm vật liệu dùng một lần.',
        sustainabilityCard3Title: 'Chương trình cộng đồng',
        sustainabilityCard3Description:
          'Các hoạt động trao quà mùa lễ hỗ trợ giáo dục và dinh dưỡng, lan tỏa niềm vui vượt khỏi bàn tiệc.',
        sustainabilityCard4Title: 'Nhà bánh không rác thải',
        sustainabilityCard4Description:
          'Quy trình chuẩn xác giúp chúng tôi tận dụng nguyên liệu, trao tặng phần dư cho đối tác và tổ chức thiện nguyện địa phương.',
        ctaBannerHeading: 'Cùng Kinh Đô tạo nên lễ hội tiếp theo',
        ctaBannerText:
          'Đồng hành với nghệ nhân ẩm thực để kiến tạo trải nghiệm bánh trung thu và quà tặng theo mong muốn của bạn.',
        ctaBannerButton: 'Bắt đầu trò chuyện',
        footerCopy: 'Kinh Do Foods. Bảo lưu mọi quyền.',
        footerSocial: 'Theo dõi hành trình của chúng tôi trên',
        ageGateTitle: 'Xác nhận độ tuổi',
        ageGateDescription: 'Chọn năm sinh của bạn để tiếp tục vào Kinh Đô Foods.',
        ageGateConfirm: 'Vào trang web'
      }
    };

    const AGE_GATE_MESSAGES = {
      error: {
        en: 'Please select your birth year to continue.',
        vi: 'Vui lòng chọn năm sinh để tiếp tục.'
      }
    };
    const AGE_GATE_STORAGE_KEY = 'kinhdoAgeGateStatus';
    const AGE_GATE_BIRTH_YEAR_KEY = 'kinhdoBirthYear';
    const AGE_GATE_YEAR_START = 1945;
    const AGE_GATE_YEAR_END = 2025;
    const AGE_GATE_FILLER_COUNT = 2;
    const GEN_Z_YEAR_THRESHOLD = 1997;
    const GENERATION_CLASSIC = 'classic';
    const GENERATION_GEN_Z = 'genZ';

    const translatableElements = document.querySelectorAll('[data-i18n]');
    const languageToggle = document.getElementById('language-toggle');
    const ageGate = document.getElementById('age-gate');
    const agePicker = document.getElementById('age-picker');
    const agePickerList = document.getElementById('age-picker-list');
    const ageGateCloseButton = document.getElementById('age-gate-close');
    const ageGateConfirmButton = document.getElementById('age-gate-confirm');
    const ageGateFootnote = document.getElementById('age-gate-footnote');
    const generationAwareElements = document.querySelectorAll('[data-i18n-classic], [data-i18n-genz]');
    const heroCardImage = document.querySelector('.hero-card-media img');
    const generationGroups = document.querySelectorAll('[data-generation-group]');
    const heroCardMediaConfig = {
      [GENERATION_CLASSIC]: {
        src: 'vn-11134207-7r98o-lr866fv2vj5w60-3532510397.jpg',
        alt: {
          en: 'Lotus seed and salted egg yolk mooncake gift box with gilded accents.',
          vi: 'Hộp bánh trung thu hạt sen và trứng muối vàng với họa tiết ánh kim.'
        }
      },
      [GENERATION_GEN_Z]: {
        src: 'Gen%20Z/lava-trung-chay-6-banh-2025.jpg',
        alt: {
          en: 'Lava mooncake gift box featuring aged molten salted egg fillings.',
          vi: 'Hộp bánh lava trứng chảy với nhân trứng muối ủ lâu tan chảy.'
        }
      }
    };

    function parseBirthYear(value) {
      const year = Number.parseInt(value, 10);
      if (!Number.isInteger(year)) {
        return null;
      }
      if (year < AGE_GATE_YEAR_START || year > AGE_GATE_YEAR_END) {
        return null;
      }
      return year;
    }

    function determineGenerationFromBirthYear(year) {
      if (Number.isInteger(year) && year > GEN_Z_YEAR_THRESHOLD) {
        return GENERATION_GEN_Z;
      }
      return GENERATION_CLASSIC;
    }

    function applyGenerationMode() {
      const isGenZ = currentGeneration === GENERATION_GEN_Z;

      document.body.classList.toggle('generation-genz', isGenZ);
      document.body.classList.toggle('generation-classic', !isGenZ);

      generationAwareElements.forEach((element) => {
        const targetKey = isGenZ ? element.dataset.i18nGenz : element.dataset.i18nClassic;
        if (targetKey) {
          element.dataset.i18n = targetKey;
        }
      });

      if (heroCardImage) {
        const config = heroCardMediaConfig[isGenZ ? GENERATION_GEN_Z : GENERATION_CLASSIC];
        if (config?.src && heroCardImage.getAttribute('src') !== config.src) {
          heroCardImage.setAttribute('src', config.src);
        }
        if (config?.alt) {
          const altText = config.alt[currentLanguage] ?? config.alt.en;
          if (altText) {
            heroCardImage.setAttribute('alt', altText);
          }
        }
      }

      generationGroups.forEach((group) => {
        const mode = group.dataset.generationGroup;
        if (mode === GENERATION_GEN_Z) {
          group.hidden = !isGenZ;
        } else if (mode === GENERATION_CLASSIC) {
          group.hidden = isGenZ;
        }
      });
    }

    function updateGenerationFromBirthYear(year) {
      const parsedYear = typeof year === 'number' ? year : parseBirthYear(year);
      currentGeneration = determineGenerationFromBirthYear(parsedYear);
      applyGenerationMode();
      applyTranslations(currentLanguage);
    }

    let agePickerOptions = [];
    let agePickerOptionHeight = 0;
    let activeAgeOption = null;
    let selectedBirthYear = null;
    let ageGateInitialized = false;
    let agePickerScrollTimeout;
    let currentGeneration = determineGenerationFromBirthYear(
      parseBirthYear(localStorage.getItem(AGE_GATE_BIRTH_YEAR_KEY))
    );

    const LANGUAGE_STORAGE_KEY = 'kinhdoLanguage';
    const savedLanguage = localStorage.getItem(LANGUAGE_STORAGE_KEY);
    let currentLanguage = savedLanguage === 'en' || savedLanguage === 'vi' ? savedLanguage : 'vi';

    const applyTranslations = (language) => {
      const locale = language === 'vi' ? 'vi' : 'en';
      document.documentElement.setAttribute('lang', locale);

      translatableElements.forEach((element) => {
        const key = element.dataset.i18n;
        const translation = translations[locale][key];

        if (translation) {
          element.textContent = translation;
        }
      });
    };

    const updateToggleLabel = (language) => {
      if (!languageToggle) return;

      if (language === 'vi') {
        languageToggle.textContent = 'English';
        languageToggle.setAttribute('aria-label', 'Switch to English');
      } else {
        languageToggle.textContent = 'Tiếng Việt';
        languageToggle.setAttribute('aria-label', 'Switch to Vietnamese');
      }
    };

    const getAgeGateMessage = (key, locale) => AGE_GATE_MESSAGES[key]?.[locale] ?? '';

    const setAgeGateMessage = (key) => {
      if (!ageGateFootnote) return;

      if (!key) {
        ageGateFootnote.textContent = '';
        delete ageGateFootnote.dataset.messageKey;
        return;
      }

      const locale = currentLanguage === 'vi' ? 'vi' : 'en';
      const message = getAgeGateMessage(key, locale);

      if (message) {
        ageGateFootnote.textContent = message;
        ageGateFootnote.dataset.messageKey = key;
      } else {
        ageGateFootnote.textContent = '';
        delete ageGateFootnote.dataset.messageKey;
      }
    };

    const measureOptionHeight = () => {
      if (!agePickerList) return;
      const sample = agePickerList.querySelector('.age-picker-option:not(.age-picker-spacer)');
      if (sample) {
        agePickerOptionHeight = sample.getBoundingClientRect().height;
      }
    };

    const getActualIndexBounds = () => {
      if (!agePickerOptions.length) {
        return { min: 0, max: 0 };
      }

      return {
        min: AGE_GATE_FILLER_COUNT,
        max: agePickerOptions.length - AGE_GATE_FILLER_COUNT - 1
      };
    };

    const clampToActualIndex = (index) => {
      const bounds = getActualIndexBounds();
      return Math.min(Math.max(index, bounds.min), bounds.max);
    };

    const setActiveAgeOption = (option) => {
      if (activeAgeOption) {
        activeAgeOption.classList.remove('age-option-active');
        activeAgeOption.setAttribute('aria-selected', 'false');
      }

      if (!option || option.classList.contains('age-picker-spacer')) {
        activeAgeOption = null;
        selectedBirthYear = null;
        if (agePicker) {
          agePicker.removeAttribute('aria-activedescendant');
        }
        return;
      }

      option.classList.add('age-option-active');
      option.setAttribute('aria-selected', 'true');
      activeAgeOption = option;
      selectedBirthYear = parseInt(option.dataset.year, 10);
      if (agePicker) {
        agePicker.setAttribute('aria-activedescendant', option.id);
      }
      setAgeGateMessage(null);
    };

    const getScrollTopForIndex = (index) => {
      if (!agePickerOptionHeight) {
        measureOptionHeight();
      }

      if (!agePickerOptionHeight) return 0;

      const bounds = getActualIndexBounds();
      const boundedIndex = Math.min(Math.max(index, bounds.min), bounds.max);
      return (boundedIndex - AGE_GATE_FILLER_COUNT) * agePickerOptionHeight;
    };

    const getIndexFromScrollTop = () => {
      if (!agePickerOptionHeight) {
        measureOptionHeight();
      }

      if (!agePickerOptionHeight) return AGE_GATE_FILLER_COUNT;
      const rawIndex = Math.round(agePicker.scrollTop / agePickerOptionHeight) + AGE_GATE_FILLER_COUNT;
      return clampToActualIndex(rawIndex);
    };

    const scrollToAgeOption = (option, behavior = 'smooth') => {
      if (!agePicker || !option) return;
      if (!agePickerOptionHeight) {
        measureOptionHeight();
      }

      const index = agePickerOptions.indexOf(option);
      if (index === -1 || !agePickerOptionHeight) return;
      const targetTop = getScrollTopForIndex(index);

      if (behavior === 'auto') {
        agePicker.scrollTop = targetTop;
      } else {
        agePicker.scrollTo({ top: targetTop, behavior });
      }

      setActiveAgeOption(option);
    };

    const scrollToYear = (year, behavior = 'smooth') => {
      if (!agePickerOptions.length) return;
      if (year < AGE_GATE_YEAR_START || year > AGE_GATE_YEAR_END) return;

      const offset = AGE_GATE_YEAR_END - year;
      const index = AGE_GATE_FILLER_COUNT + offset;
      const option = agePickerOptions[index];
      if (option) {
        scrollToAgeOption(option, behavior);
      }
    };

    const updateActiveFromScroll = () => {
      if (!agePicker || !agePickerOptionHeight) {
        measureOptionHeight();
      }

      if (!agePicker || !agePickerOptionHeight) return;

      const index = getIndexFromScrollTop();
      const option = agePickerOptions[index];
      if (option && option !== activeAgeOption) {
        setActiveAgeOption(option);
      }
    };

    const snapToNearest = (behavior = 'smooth') => {
      if (!agePicker || !agePickerOptionHeight) return;

      const index = getIndexFromScrollTop();
      const option = agePickerOptions[index];
      if (!option) return;

      const desiredTop = getScrollTopForIndex(index);
      if (Math.abs(agePicker.scrollTop - desiredTop) > 1) {
        if (behavior === 'auto') {
          agePicker.scrollTop = desiredTop;
        } else {
          agePicker.scrollTo({ top: desiredTop, behavior });
        }
      }

      setActiveAgeOption(option);
    };

    const moveAgeSelection = (direction) => {
      if (!activeAgeOption) return;
      const currentIndex = agePickerOptions.indexOf(activeAgeOption);
      if (currentIndex === -1) return;

      const bounds = getActualIndexBounds();
      let nextIndex = currentIndex + direction;
      nextIndex = Math.min(Math.max(nextIndex, bounds.min), bounds.max);

      const option = agePickerOptions[nextIndex];
      if (option) {
        scrollToAgeOption(option);
      }
    };

    const getFocusableAgeGateElements = () => {
      if (!ageGate || ageGate.hidden) return [];

      return Array.from(
        ageGate.querySelectorAll('button, [href], [tabindex]:not([tabindex="-1"])')
      ).filter(
        (element) =>
          !element.hasAttribute('disabled') &&
          element.getAttribute('tabindex') !== '-1' &&
          element.closest('[hidden]') === null
      );
    };

    const hideAgeGate = (immediate = false) => {
      if (!ageGate || ageGate.hidden) return;

      ageGate.setAttribute('aria-hidden', 'true');
      document.body.classList.remove('age-gate-open');

      if (immediate) {
        ageGate.hidden = true;
        ageGate.classList.remove('is-hidden');
        return;
      }

      ageGate.classList.add('is-hidden');
      window.setTimeout(() => {
        if (ageGate.classList.contains('is-hidden')) {
          ageGate.hidden = true;
          ageGate.classList.remove('is-hidden');
        }
      }, 280);
    };

    const showAgeGate = (initial = false) => {
      if (!ageGate) return;

      ageGate.hidden = false;
      ageGate.removeAttribute('aria-hidden');
      document.body.classList.add('age-gate-open');

      if (!initial) {
        ageGate.classList.add('is-hidden');
        requestAnimationFrame(() => {
          ageGate.classList.remove('is-hidden');
        });
      }

      window.setTimeout(() => {
        if (agePicker) {
          agePicker.focus({ preventScroll: true });
        }
      }, 60);
    };

    const updateAgeGateLanguage = (locale) => {
      if (ageGateCloseButton) {
        ageGateCloseButton.setAttribute(
          'aria-label',
          locale === 'vi' ? 'Đóng cửa sổ xác minh tuổi' : 'Close age confirmation'
        );
      }

      if (agePicker) {
        agePicker.setAttribute(
          'aria-label',
          locale === 'vi' ? 'Chọn năm sinh của bạn' : 'Select your birth year'
        );
      }

      if (ageGateConfirmButton) {
        ageGateConfirmButton.setAttribute('aria-label', translations[locale].ageGateConfirm);
      }

      if (ageGateFootnote && ageGateFootnote.dataset.messageKey) {
        const message = getAgeGateMessage(ageGateFootnote.dataset.messageKey, locale);
        if (message) {
          ageGateFootnote.textContent = message;
        }
      }
    };

    const confirmAgeGate = () => {
      if (!selectedBirthYear) {
        setAgeGateMessage('error');
        if (agePicker) {
          agePicker.focus({ preventScroll: true });
        }
        return;
      }

      localStorage.setItem(AGE_GATE_STORAGE_KEY, 'verified');
      localStorage.setItem(AGE_GATE_BIRTH_YEAR_KEY, String(selectedBirthYear));
      updateGenerationFromBirthYear(selectedBirthYear);
      setAgeGateMessage(null);
      hideAgeGate();
    };

    const dismissAgeGate = () => {
      localStorage.setItem(AGE_GATE_STORAGE_KEY, 'dismissed');
      setAgeGateMessage(null);
      hideAgeGate();
    };

    const handleAgeGateKeydown = (event) => {
      if (!ageGate || ageGate.hidden) return;

      if (event.key === 'Tab') {
        const focusable = getFocusableAgeGateElements();
        if (!focusable.length) return;

        const first = focusable[0];
        const last = focusable[focusable.length - 1];

        if (event.shiftKey) {
          if (document.activeElement === first || !ageGate.contains(document.activeElement)) {
            last.focus();
            event.preventDefault();
          }
        } else if (document.activeElement === last) {
          first.focus();
          event.preventDefault();
        }
      } else if (event.key === 'Escape') {
        event.preventDefault();
        dismissAgeGate();
      }
    };

    const initializeAgeGate = () => {
      if (ageGateInitialized || !ageGate || !agePicker || !agePickerList) return;
      ageGateInitialized = true;

      const fragment = document.createDocumentFragment();
      const createSpacer = () => {
        const spacer = document.createElement('li');
        spacer.className = 'age-picker-option age-picker-spacer';
        spacer.setAttribute('aria-hidden', 'true');
        spacer.setAttribute('role', 'presentation');
        fragment.appendChild(spacer);
      };

      for (let i = 0; i < AGE_GATE_FILLER_COUNT; i += 1) {
        createSpacer();
      }

      for (let year = AGE_GATE_YEAR_END; year >= AGE_GATE_YEAR_START; year -= 1) {
        const option = document.createElement('li');
        option.className = 'age-picker-option';
        option.dataset.year = String(year);
        option.id = `age-option-${year}`;
        option.setAttribute('role', 'option');
        option.setAttribute('aria-selected', 'false');
        option.textContent = year;
        fragment.appendChild(option);
      }

      for (let i = 0; i < AGE_GATE_FILLER_COUNT; i += 1) {
        createSpacer();
      }

      agePickerList.appendChild(fragment);
      agePickerOptions = Array.from(agePickerList.children);

      measureOptionHeight();

      const storedYear = parseBirthYear(localStorage.getItem(AGE_GATE_BIRTH_YEAR_KEY));
      const defaultYear = Number.isInteger(storedYear) ? storedYear : 2000;

      scrollToYear(defaultYear, 'auto');
      snapToNearest('auto');

      agePicker.addEventListener('scroll', () => {
        updateActiveFromScroll();
        if (agePickerScrollTimeout) {
          clearTimeout(agePickerScrollTimeout);
        }
        agePickerScrollTimeout = window.setTimeout(() => {
          snapToNearest();
        }, 120);
      });

      agePicker.addEventListener('keydown', (event) => {
        if (event.key === 'ArrowUp') {
          event.preventDefault();
          moveAgeSelection(-1);
        } else if (event.key === 'ArrowDown') {
          event.preventDefault();
          moveAgeSelection(1);
        } else if (event.key === 'Home') {
          event.preventDefault();
          const bounds = getActualIndexBounds();
          scrollToAgeOption(agePickerOptions[bounds.min]);
        } else if (event.key === 'End') {
          event.preventDefault();
          const bounds = getActualIndexBounds();
          scrollToAgeOption(agePickerOptions[bounds.max]);
        } else if (event.key === 'Enter') {
          event.preventDefault();
          snapToNearest();
          confirmAgeGate();
        }
      });

      agePicker.addEventListener('focus', () => {
        if (!activeAgeOption) {
          snapToNearest('auto');
        }
      });

      agePickerList.addEventListener('click', (event) => {
        const option = event.target.closest('.age-picker-option');
        if (!option || option.classList.contains('age-picker-spacer')) return;
        scrollToAgeOption(option);
      });

      if (ageGateCloseButton) {
        ageGateCloseButton.addEventListener('click', () => {
          dismissAgeGate();
        });
      }

      if (ageGateConfirmButton) {
        ageGateConfirmButton.addEventListener('click', () => {
          confirmAgeGate();
        });
      }

      ageGate.addEventListener('keydown', handleAgeGateKeydown);

      window.addEventListener('resize', () => {
        const previousHeight = agePickerOptionHeight;
        measureOptionHeight();
        if (
          agePickerOptionHeight &&
          previousHeight !== agePickerOptionHeight &&
          activeAgeOption
        ) {
          scrollToAgeOption(activeAgeOption, 'auto');
        }
      });

      const status = localStorage.getItem(AGE_GATE_STORAGE_KEY);
      if (status === 'verified' || status === 'dismissed') {
        hideAgeGate(true);
      } else {
        showAgeGate(true);
      }
    };

    const setLanguage = (language) => {
      const locale = language === 'vi' ? 'vi' : 'en';
      currentLanguage = locale;
      applyGenerationMode();
      applyTranslations(locale);
      updateToggleLabel(locale);
      updateAgeGateLanguage(locale);
      localStorage.setItem(LANGUAGE_STORAGE_KEY, locale);
    };

    if (languageToggle) {
      languageToggle.addEventListener('click', () => {
        setLanguage(currentLanguage === 'en' ? 'vi' : 'en');
      });
    }

    setLanguage(currentLanguage);
    initializeAgeGate();
  </script>
</body>
</html>
